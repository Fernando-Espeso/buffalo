{% schema %}
{
  "name": "Buffalo-live",
  "settings": [],
  "blocks": [
    {
      "type": "item",
      "name": "Elemento",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Imagen"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Enlace"
        },
        {
          "type": "text",
          "id": "caption",
          "label": "Texto (caption)"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Bloque Repetidor",
      "category": "Custom"
    }
  ]
}
{% endschema %}

<div class="swiper-live">
    <div class="swiper-wrapper">
      {% for block in section.blocks %}
        {% assign img = block.settings.image %}
        {% assign link = block.settings.link %}
        {% assign caption = block.settings.caption %}
        
        <div class="swiper-slide">
          {% if link != blank %}
            <a href="{{ link }}">
          {% endif %}
          
          {% if img != blank %}
            <img src="{{ img | img_url: 'medium' }}" alt="{{ caption }}">
          {% endif %}
          
          {% if caption != blank %}
            <p>{{ caption }}</p>
          {% endif %}
          
          {% if link != blank %}
            </a>
          {% endif %}
        </div>
      {% endfor %}
    </div>
  </div>
  
  <div class="swiper-pagination"></div>

<style>

</style>
<script>
    const swiper = new Swiper('.swiper-live', {
        loop: true,
        direction: 'horizontal',
        slidesPerView: 11,
        initialSlide: 5,
        loopedSlides: 20,
        centeredSlides: true,
        spaceBetween: 3,
        on: {
          init: function () {
            const paginationEl = document.querySelector('.swiper-pagination');
            const totalSlides = swiper.slides.length - swiper.loopedSlides * 2; // remove duplicated ones
      
            // render custom dots
            for (let i = 0; i < totalSlides; i++) {
              const dot = document.createElement('span');
              dot.classList.add('swiper-pagination-bullet');
              if (i === 0) dot.classList.add('swiper-pagination-bullet-active');
      
              dot.addEventListener('click', () => {
                swiper.slideToLoop(i, 500); // jump to correct slide index (loop safe)
              });
      
              paginationEl.appendChild(dot);
            }
      
            swiper.on('slideChange', () => {
              const bullets = paginationEl.querySelectorAll('.swiper-pagination-bullet');
              bullets.forEach(b => b.classList.remove('swiper-pagination-bullet-active'));
              const realIndex = swiper.realIndex;
              if (bullets[realIndex]) {
                bullets[realIndex].classList.add('swiper-pagination-bullet-active');
              }
            });
          }
        }
      });
      
</script>
