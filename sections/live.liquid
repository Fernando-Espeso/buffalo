{% schema %}
{
  "name": "Buffalo-live",
  "settings": [],
  "blocks": [
    {
      "type": "item",
      "name": "Elemento",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Imagen"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Enlace"
        },
        {
          "type": "text",
          "id": "caption",
          "label": "Texto (caption)"
        },
        {
          "type": "select",
          "id": "role",
          "label": "Categoría",
          "options": [
            { "value": "photographer", "label": "Photographer" },
            { "value": "director", "label": "Director" },
            { "value": "fashion_editor", "label": "Fashion Editor" },
            { "value": "hot_picks", "label": "Hot Picks" },
            { "value": "directors", "label": "Directors" }
          ]
        },
        {
          "type": "text",
          "id": "name",
          "label": "Nombre"
        }
      ]
    }
    
  ],
  "presets": [
    {
      "name": "Buffalo Live",
      "category": "Custom"
    }
  ]
}
{% endschema %}

{% assign roles_string = "" %}
{% for block in section.blocks %}
  {% assign role = block.settings.role %}
  {% unless roles_string contains role %}
    {% assign roles_string = roles_string | append: role | append: "," %}
  {% endunless %}
{% endfor %}

{% assign roles = roles_string | split: "," %}
{% assign roles = roles | uniq %}

<div class="category-filters">
  {% for role in roles %}
    {% unless role == "" %}
      <details class="category-item" data-role="{{ role }}">
        <summary>{{ role | replace: "_", " " | capitalize }}</summary>
        <ul class="names-list" id="names-{{ role | handle }}"></ul>
      </details>
    {% endunless %}
  {% endfor %}
</div>

<div class="swiper-live">
    <div class="swiper-wrapper">
      {% for block in section.blocks %}
        {% assign img = block.settings.image %}
        {% assign link = block.settings.link %}
        {% assign caption = block.settings.caption %}
        
        <div class="swiper-slide" data-role="{{ block.settings.role }}" data-name="{{ block.settings.name }}">
          {% if block.settings.link != blank %}
            <a href="{{ block.settings.link }}">
          {% endif %}
        
          {% if block.settings.image != blank %}
            <img src="{{ block.settings.image | img_url: 'medium' }}" alt="{{ block.settings.caption }}">
          {% endif %}
        
          {% if block.settings.caption != blank %}
            <p class="caption">{{ block.settings.caption }}</p>
          {% endif %}
        
          {% if block.settings.link != blank %}
            </a>
          {% endif %}
        </div>
      {% endfor %}
    </div>
  </div>
  
  <div class="swiper-pagination"></div>

<style>
    .swiper-pagination-bullet-active {
        opacity: black;
        background: black;
        margin:0px;
    }
    .swiper-pagination-bullet {
        margin: 0px !important;
    }
    .swiper-slide img {
        transition: transform 0.3s ease;
        cursor: pointer;
        z-index: 1;
    }
    .swiper-slide img.expanded {
        transform: scale(2);
        z-index: 10;
        position: relative;
    }
</style>
<script>
  const swiper = new Swiper('.swiper-live', {
    direction: 'horizontal',
    slidesPerView: 9.5,
    loopedSlides: 20,
    spaceBetween: 3,
    pagination: {
      el: '.swiper-pagination',
      clickable: true,
      renderBullet: function (index, className) {
        return `<span class="${className}"></span>`;
      }
    },
  });

  // Escuchar clicks en las imágenes del swiper
  document.querySelectorAll('.swiper-live .swiper-slide img').forEach(img => {
    img.addEventListener('hover', () => {
      // Si ya está expandida, quitar la clase
      const wasExpanded = img.classList.contains('expanded');
      
      // Quitar la clase a todas
      document.querySelectorAll('.swiper-live .swiper-slide img').forEach(i => i.classList.remove('expanded'));

      // Si no estaba expandida, expandir esta
      if (!wasExpanded) {
        img.classList.add('expanded');
      }
    });
  });
</script>
<script>
  document.querySelectorAll('.category-item').forEach(detail => {
    detail.addEventListener('toggle', () => {
      if (!detail.open) return;

      const selectedRole = detail.dataset.role;
      const nameList = document.getElementById(`names-${selectedRole.replace(/\s+/g, '-').toLowerCase()}`);
      nameList.innerHTML = ''; // limpiar

      const names = new Set();

      // mostrar solo slides con el role actual
      document.querySelectorAll('.swiper-slide').forEach(slide => {
        const role = slide.dataset.role;
        const name = slide.dataset.name;

        if (role === selectedRole) {
          slide.style.opacity = '1';
          if (name) names.add(name);
        } else {
          slide.style.opacity = '0.3';
        }
      });

      // rellenar la lista de nombres
      names.forEach(name => {
        const li = document.createElement('li');
        li.textContent = name;
        nameList.appendChild(li);
      });

      // actualizar swiper
      if (typeof swiper !== 'undefined') {
        swiper.update();
      }
    });
  });
</script>

